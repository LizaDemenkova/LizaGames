<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>Квіз-екcель</title>
  <style>
    body {
      background: linear-gradient(135deg, #1e2a2f 60%, #204040 100%);
      color: #eee;
      min-height: 100vh;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #main {
      margin-top: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 98vw;
    }
    #main.hide { display: none; }
    #pw-modal-bg {
      position: fixed; left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(30,35,40,0.83); z-index: 99; display: flex; align-items: center; justify-content: center;
    }
    #pw-modal {
      background: #fff; color: #222; border-radius: 16px; box-shadow: 0 8px 38px #0019; min-width: 340px; max-width: 92vw;
      padding: 30px 26px 24px 26px; display: flex; flex-direction: column; align-items: center;
    }
    #pw-modal h2 { margin: 0 0 18px 0; font-size: 1.21em; }
    #pw-modal label { margin-bottom: 16px; display: block; font-size: 1em; }
    #pw-modal input[type=password], #pw-modal input[type=text] {
      width: 220px; font-size: 1.11em; padding: 8px 38px 8px 10px; border-radius: 7px; border: 1.6px solid #ddd;
      margin-bottom: 15px; outline: none; transition: border .17s;
    }
    #pw-modal input[type=password]:focus, #pw-modal input[type=text]:focus { border: 1.6px solid #2cb17e; }
    #pw-modal .pw-btns { display: flex; gap: 16px; margin-top: 6px; }
    #pw-modal button {
      padding: 7px 32px; border-radius: 8px; font-size: 1.07em; background: #2cb17e; color: #fff;
      border: none; cursor: pointer; font-weight: 600; transition: background .14s;
    }
    #pw-modal button:hover { background: #229167; }
    #pw-modal .cancel-btn {
      background: #ddd; color: #222;
    }
    #pw-modal .cancel-btn:hover { background: #bbb; }
    #pw-modal .pw-error {
      color: #d32f2f; font-size: 0.99em; margin-bottom: 8px; text-align: center; min-height: 22px;
    }
    #pw-eye-btn {
      position: absolute;
      right: 35px; top: 44px;
      border: none; background: none; cursor: pointer; padding: 0; z-index: 3;
    }
    #pw-eye-btn svg { width: 24px; height: 24px; fill: #8bc34a; }
    #pw-eye-btn.hide svg { fill: #bbb; }
    .quiz-box {
      background: #f7fafc;
      color: #233;
      border-radius: 20px;
      box-shadow: 0 4px 28px rgba(0,0,0,0.11);
      padding: 26px 16px 20px 16px;
      margin-bottom: 28px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 260px;
      max-width: 90vw;
    }
    #question { font-size: 1.17rem; margin-bottom: 18px; font-weight: 600; text-align: center; min-height: 38px; letter-spacing: .01em;}
    #choices { display: flex; gap: 10px; justify-content: center; margin-bottom: 2px; opacity: 1; transition: opacity .3s;}
    .btn { padding: 8px 23px; font-size: 1rem; border: none; border-radius: 7px; cursor: pointer; font-weight: 600; transition: transform 0.08s; box-shadow: 0 2px 10px #0002;}
    .btn:active { transform: scale(0.97);}
    .red    { background: #d32f2f; color: #fff; }
    .yellow { background: #ffc107; color: #222; }
    .green  { background: #388e3c; color: #fff; }
    .table-wrap {
      position: relative;
      margin-bottom: 13px;
      border-radius: 13px;
      background: #1a2324;
      box-shadow: 0 2px 18px #0004;
      min-width: 220px;
      min-height: 100px;
      max-width: 96vw;
      max-height: 72vh;
      overflow: hidden;
      display: inline-block;
      width: 700px;
      height: 350px;
      transition: box-shadow .23s;
    }
    .resize-rect {
      position: absolute;
      background: #ffe57f66;
      opacity: 0.28;
      z-index: 5;
      transition: opacity .13s, background .13s;
      border-radius: 5px;
    }
    .resize-rect:hover, .resize-rect.active {
      background: #ffe57fbb;
      opacity: 0.75;
    }
    .resize-rect.r { width: 10px; height: 48%; right: 1px; top: 24%; cursor: ew-resize;}
    .resize-rect.b { height: 10px; width: 48%; left: 24%; bottom: 1px; cursor: ns-resize;}
    .resize-rect.br { width: 18px; height: 18px; right: 1px; bottom: 1px; cursor: nwse-resize;}
    .table-controls {
      position: absolute;
      top: 8px; left: 12px; z-index: 10;
      display: flex; gap: 6px;
    }
    .mini-btn {
      width: 25px; height: 23px;
      background: #31484d;
      color: #ffe57f;
      border-radius: 5px;
      border: 2px solid #295757;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.09em;
      cursor: pointer;
      box-shadow: 0 1px 2px #0002;
      user-select: none;
      transition: background .14s, color .14s, border .13s;
      margin-right: 2px;
    }
    .mini-btn:active {
      background: #ffe57f;
      color: #1a2727;
      border-color: #ffe57f;
      transform: scale(0.95);
    }
    .scalable-table {
      width: 100%; height: 100%;
      overflow: auto !important;
      transition: font-size .20s, padding .20s;
      min-width: 180px; min-height: 60px;
      background: inherit;
      box-sizing: border-box;
    }
    table { border-collapse: collapse; background: #223233; color: #eee; min-width: 340px; font-size: 1em; position: relative; }
    th, td {
      border: 1px solid #455; padding: 6px 7px;
      text-align: center; min-width: 90px; white-space: nowrap;
      background: inherit; transition: background .21s, opacity .24s;
      position: relative; opacity: 1;
    }
    th, td { transition: opacity .24s; }
    th.new-cell, td.new-cell { opacity: 0; animation: fadeInCell .55s forwards; }
    @keyframes fadeInCell { from { opacity: 0; } to { opacity: 1; } }
    th { background: #295757; color: #ffe57f; font-size: 1em; transition: font-size .2s; }
    .row-num { background: #31484d; color: #ffe57f; font-weight: bold; min-width: 36px; width: 36px; font-size: 0.96em; border-left: 2px solid #295757; border-top: 2px solid #295757;}
    .dark-cell { background: #2a2f32 !important; color: #555 !important; font-size: 1.1em; font-weight: 600; opacity: 0.6;}
    .sum-col, .color-sect { font-weight: 700; font-size: 0.97em; border-left: 2px solid #295757;}
    .sum-col { background: #324d40; color: #fff;}
    .color-sect { padding: 0; background: #223233;}
    .color-sect > div { padding: 4px 0; border-radius: 10px 10px 0 0; margin: 0; font-size: 1.01em; font-weight: 700; letter-spacing: .3px;}
    .color-orange { background: #FF9800; color: #fff;}
    .color-yellow { background: #FFD600; color: #222;}
    .color-green  { background: #00C853; color: #fff;}
    .sum-row td { background: #182728; font-weight: bold; color: #fff; font-size: 1.01em;}
    .sum-final { border-radius: 0 0 10px 10px; font-size: 1.11em;}
    .sum-final.color-orange { background: #FF9800; color: #fff;}
    .sum-final.color-yellow { background: #FFD600; color: #222;}
    .sum-final.color-green  { background: #00C853; color: #fff;}
    .sum-final.empty { background: #263330; color: #888;}
    .sum-live { font-size: 1.1em; font-weight: bold; color: #66eea6; letter-spacing: .01em; background: #294840; border-radius: 0 0 10px 10px; border-top: 3px solid #fff780; min-width: 56px; transition: background .2s, color .2s; animation: pop .25s;}
    @keyframes pop { 0% {transform: scale(1.11);} 100% {transform: scale(1);}
    }
    .counter-box { margin: 10px auto 34px auto; padding: 9px 18px; background: #36fa99; color: #062c17; border-radius: 16px; display: inline-block; font-weight: 700; font-size: 1.09em; box-shadow: 0 2px 10px #0001; letter-spacing: .03em; transition: background .18s; border: 2.5px solid #77ffc3; text-shadow: 0 1px 0 #fff, 0 2px 3px #69fcaf66;}
    @media (max-width: 650px) {
      .table-wrap { min-width: 100vw; max-width: 100vw; }
      .scalable-table { min-width: 140px; }
      table { min-width: 140px;}
      th, td { min-width: 35px;}
    }
  </style>
</head>
<body>
<script>
  // --- Паролі: кожен діє 1 хвилину з моменту першого застосування ---
  const PASSWORDS = [
    { key: 'pw1', value: 'parol2024' },
    { key: 'pw2', value: 'kviz2024' },
    { key: 'pw3', value: 'ekolog2024' }
  ];
  const VALID_MS = 60 * 1000; // 1 хвилина

  // Очищаем просроченные пароли при загрузке страницы
  function clearExpiredPasswords() {
    let access = localStorage.getItem('quiz_access');
    if (!access) return;
    access = JSON.parse(access);
    let now = Date.now();
    let changed = false;
    for (let pass of PASSWORDS) {
      let ts = access[pass.key];
      if (ts && now - ts > VALID_MS) {
        delete access[pass.key];
        changed = true;
      }
    }
    if (changed) localStorage.setItem('quiz_access', JSON.stringify(access));
  }

  function showPwModal() {
    return new Promise((resolve, reject) => {
      const modalBg = document.createElement('div');
      modalBg.id = 'pw-modal-bg';
      modalBg.innerHTML = `
        <form id="pw-modal" autocomplete="off" style="position:relative">
          <h2>Введіть пароль для входу на сайт</h2>
          <div class="pw-error" id="pw-error"></div>
          <label style="position:relative; display:block;">
            <input id="pw-input" type="password" autocomplete="current-password" maxlength="40" placeholder="Пароль" required />
            <button id="pw-eye-btn" tabindex="-1" type="button" class="hide" aria-label="Показати пароль">
              <svg viewBox="0 0 24 24"><path d="M12 4.5C6.477 4.5 1.708 8.096.173 13.016c-.081.264-.081.551 0 .815C1.708 19.904 6.477 23.5 12 23.5s10.292-3.596 11.827-8.516c.081-.264.081-.551 0-.815C22.292 8.096 17.523 4.5 12 4.5zm0 16c-4.6 0-8.478-2.905-9.876-7C3.522 9.405 7.4 6.5 12 6.5s8.478 2.905 9.876 7c-1.398 4.095-5.276 7-9.876 7zm0-12a5 5 0 100 10 5 5 0 000-10zm0 8a3 3 0 110-6 3 3 0 010 6z"/></svg>
            </button>
          </label>
          <div class="pw-btns">
            <button type="submit">OK</button>
            <button type="button" class="cancel-btn">Відміна</button>
          </div>
        </form>`;
      document.body.appendChild(modalBg);

      const input = document.getElementById('pw-input');
      const error = document.getElementById('pw-error');
      const eyeBtn = document.getElementById('pw-eye-btn');
      let pwVisible = false;
      eyeBtn.onclick = (e) => {
        e.preventDefault();
        pwVisible = !pwVisible;
        input.type = pwVisible ? 'text' : 'password';
        eyeBtn.classList.toggle('hide', !pwVisible);
      };

      input.focus();

      modalBg.querySelector('form').onsubmit = (e) => {
        e.preventDefault();
        const pass = input.value.trim();
        let matched = PASSWORDS.find(p => p.value === pass);
        if (matched) {
          // Ставимо таймстемп тільки для цього пароля
          let obj = localStorage.getItem('quiz_access');
          obj = obj ? JSON.parse(obj) : {};
          if (!obj[matched.key]) obj[matched.key] = Date.now();
          localStorage.setItem('quiz_access', JSON.stringify(obj));
          document.body.removeChild(modalBg);
          resolve(matched.key);
        } else {
          error.textContent = 'Невірний пароль!';
        }
      };
      modalBg.querySelector('.cancel-btn').onclick = () => {
        document.body.removeChild(modalBg);
        reject();
      };
    });
  }

  async function passwordCheck() {
    clearExpiredPasswords();
    let access = localStorage.getItem('quiz_access');
    let usedKey = null, ok = false;
    if (access) {
      access = JSON.parse(access);
      let now = Date.now();
      for (let pass of PASSWORDS) {
        let ts = access[pass.key];
        if (ts && now - ts < VALID_MS) {
          ok = true;
          usedKey = pass.key;
          break;
        }
      }
    }
    if (!ok) {
      try {
        usedKey = await showPwModal();
        // Сразу очищаем просроченные после ввода!
        clearExpiredPasswords();
      } catch {
        document.body.innerHTML = "";
        throw "Canceled";
      }
    }
    document.getElementById('main').classList.remove('hide');
  }
</script>
<div id="main" class="hide">
  <div class="quiz-box" id="quiz-area">
    <div id="question"></div>
    <div id="choices"></div>
  </div>
  <div class="table-wrap" id="tableWrap">
    <div class="resize-rect r" id="resizeR"></div>
    <div class="resize-rect b" id="resizeB"></div>
    <div class="resize-rect br" id="resizeBR"></div>
    <div class="table-controls">
      <div class="mini-btn" onclick="resizeTable(-1)" title="Зменшити контент">−</div>
      <div class="mini-btn" onclick="resizeTable(1)"  title="Збільшити контент">+</div>
    </div>
    <div id="excel-table"></div>
  </div>
  <div id="three-counter"></div>
</div>
<script>
passwordCheck().then(startQuiz);

function startQuiz() {
  // ---- ВЕСЬ КОД КВІЗА ----
  const questions = [
    "Чому важливо сортувати сміття?",
    "Навіщо економити воду вдома?",
    "Що таке повторне використання речей?",
    "Як зменшити забруднення повітря?",
    "Чому треба саджати дерева?",
    "Яка користь громадського транспорту для екології?",
    "Чому важливо економити електроенергію?",
    "Як пластикові відходи шкодять природі?",
    "Що таке органічні продукти?",
    "Як зменшити свій вуглецевий слід?",
    "Що означає стале споживання?",
    "Чому важливо підтримувати біорізноманіття?",
    "Як можна скоротити споживання пластику?",
    "Навіщо використовувати багаторазові сумки?",
    "Що таке компостування?",
    "Як захищати рідкісні види тварин?",
    "Чому важливо зберігати ліси?",
    "Що таке відновлювана енергія?",
    "Як впливає викид CO2 на клімат?",
    "Навіщо брати участь в екологічних акціях?"
  ];
  const numRows = questions.length;
  let answers = Array(numRows).fill(null);
  let currentQuestion = 0;
  let tableScale = 1;
  const minScale = 0.1, maxScale = 1.5;
  let lastN = 1;

  function typeWriter(text, el, delay = 12, cb) {
    el.innerHTML = '';
    let i = 0;
    el.classList.add('typewriter');
    function typing() {
      if (i < text.length) {
        el.innerHTML += text[i] === '\n' ? '<br>' : text[i];
        i++;
        setTimeout(typing, delay);
      } else {
        el.classList.remove('typewriter');
        if (cb) cb();
      }
    }
    typing();
  }

  window.showQuestion = function() {
    if (currentQuestion < questions.length) {
      document.getElementById('question').innerText = `Питання ${currentQuestion+1} з 20: ${questions[currentQuestion]}`;
      document.getElementById('choices').style.opacity = 1;
      document.getElementById('choices').innerHTML = `
        <button class="btn red"    onclick="submitAnswer(0)">0</button>
        <button class="btn yellow" onclick="submitAnswer(1)">1</button>
        <button class="btn green"  onclick="submitAnswer(3)">3</button>
      `;
    } else {
      document.getElementById('quiz-area').style.display = 'none';
    }
    updateTable(true);
  }

  window.submitAnswer = function(val) {
    document.getElementById('choices').style.opacity = 0;
    answers[currentQuestion] = val;
    setTimeout(() => {
      currentQuestion++;
      showQuestion();
      updateCounter();
    }, 180);
  }

  function getSum() {
    return answers.reduce((a, b) => a + (b !== null ? b : 0), 0);
  }
  function getSumColor(sum) {
    if (sum >= 17 && sum < 18) return 'color-orange';
    if (sum >= 18 && sum < 25) return 'color-yellow';
    if (sum >= 25 && sum <= 30) return 'color-green';
    return 'empty';
  }
  function getSumColumn(sum) {
    if (sum >= 17 && sum < 18) return 0; // Orange
    if (sum >= 18 && sum < 25) return 1; // Yellow
    if (sum >= 25 && sum <= 30) return 2; // Green
    return -1;
  }

  window.updateTable = function(withAnimation = false) {
    const N = Math.max(1, currentQuestion);
    let thFont = N > 9 ? "0.92em" : (N > 6 ? "0.99em" : "1.06em");
    let html = `<div class="scalable-table" id="scalableTable" style="font-size: ${tableScale}em;">`;
    html += `<table><tr><th class="row-num"></th>`;
    for (let q = 0; q < N; q++) {
      let anim = (withAnimation && N > lastN && q === N-1) ? "new-cell" : "";
      html += `<th class="${anim}" style="font-size:${thFont}"><span id="header-q-${q}"></span></th>`;
    }
    html += `<th class="sum-col">Сума</th>`;
    html += `<th class="color-sect"><div class="color-orange">17–18</div></th>`;
    html += `<th class="color-sect"><div class="color-yellow">18–25</div></th>`;
    html += `<th class="color-sect"><div class="color-green">25–30</div></th>`;
    html += '</tr>';
    // Сумма (всегда сверху)
    let sum = getSum();
    let colorClass = getSumColor(sum);
    let sumCol = getSumColumn(sum);
    html += '<tr class="sum-row">';
    html += '<td></td>';
    for (let c = 0; c < N; c++) html += '<td></td>';
    html += `<td class="sum-live">${sum}</td>`;
    for (let i = 0; i < 3; i++) {
      html += (i === sumCol && currentQuestion >= numRows)
        ? `<td class="sum-final ${colorClass}">${sum}</td>`
        : `<td class="sum-final empty"></td>`;
    }
    html += '</tr>';
    // Строки-ответы: только для уже отвеченных!
    for (let r = 0; r < N; r++) {
      let rowAnim = (withAnimation && N > lastN && r === N-1) ? "new-cell" : "";
      html += `<tr><td class="row-num ${rowAnim}">${r+1}</td>`;
      for (let c = 0; c < N; c++) {
        let anim = (withAnimation && N > lastN && (c === N-1 || r === N-1)) ? "new-cell" : "";
        if (r === c) {
          html += (answers[r] === null)
            ? `<td class="dark-cell ${anim}"></td>`
            : `<td class="${anim}">${answers[r]}</td>`;
        } else {
          html += `<td class="dark-cell ${anim}"></td>`;
        }
      }
      html += `<td class="sum-col"></td><td></td><td></td><td></td></tr>`;
    }
    html += '</table></div>';
    document.getElementById('excel-table').innerHTML = html;
    if (withAnimation && N > lastN) {
      setTimeout(() => {
        let cell = document.getElementById(`header-q-${N-1}`);
        if (cell && cell.innerHTML.trim() === '') {
          typeWriter(questions[N-1], cell, 12);
        }
      }, 90);
    } else {
      for (let i = 0; i < N; i++) {
        let cell = document.getElementById(`header-q-${i}`);
        if (cell) cell.innerHTML = questions[i];
      }
    }
    lastN = N;
  }

  window.updateCounter = function() {
    let count3 = answers.filter(x => x === 3).length;
    document.getElementById('three-counter').innerHTML =
      `<div class="counter-box">Всього “3” вибрано: ${count3}</div>`;
  }

  // Кнопки +/−: меняют масштаб
  window.resizeTable = function(delta) {
    tableScale += delta * 0.09;
    if (tableScale < minScale) tableScale = minScale;
    if (tableScale > maxScale) tableScale = maxScale;
    updateTable(false);
  };

  // Ресайзеры области
  const tableWrap = document.getElementById('tableWrap');
  let isResizing = false, resizeDir = "", startX = 0, startY = 0, startW = 0, startH = 0;

  function startResize(e, dir) {
    isResizing = true;
    resizeDir = dir;
    startX = e.clientX; startY = e.clientY;
    startW = tableWrap.offsetWidth;
    startH = tableWrap.offsetHeight;
    document.body.style.userSelect = "none";
    e.target.classList.add('active');
  }
  function doResize(e) {
    if (!isResizing) return;
    let dx = e.clientX - startX;
    let dy = e.clientY - startY;
    if (resizeDir === "both") {
      tableWrap.style.width = Math.max(140, startW + dx) + "px";
      tableWrap.style.height = Math.max(60, startH + dy) + "px";
    }
    if (resizeDir === "horiz") {
      tableWrap.style.width = Math.max(140, startW + dx) + "px";
    }
    if (resizeDir === "vert") {
      tableWrap.style.height = Math.max(60, startH + dy) + "px";
    }
  }
  function stopResize(e) {
    isResizing = false;
    document.body.style.userSelect = "";
    document.querySelectorAll('.resize-rect').forEach(el=>el.classList.remove('active'));
  }
  document.getElementById('resizeBR').addEventListener("mousedown", e => startResize(e, "both"));
  document.getElementById('resizeR').addEventListener("mousedown", e => startResize(e, "horiz"));
  document.getElementById('resizeB').addEventListener("mousedown", e => startResize(e, "vert"));
  window.addEventListener("mousemove", doResize);
  window.addEventListener("mouseup", stopResize);

  // Запуск
  showQuestion();
  updateCounter();
}
</script>
</body>
</html>
