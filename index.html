<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Квиз-эксель: всегда видны все ответы и скролл</title>
  <style>
    body {
      background: linear-gradient(135deg, #1e2a2f 60%, #204040 100%);
      color: #eee;
      min-height: 100vh;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #main {
      margin-top: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 98vw;
    }
    .quiz-box {
      background: #f7fafc;
      color: #233;
      border-radius: 20px;
      box-shadow: 0 4px 28px rgba(0,0,0,0.11);
      padding: 26px 16px 20px 16px;
      margin-bottom: 28px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 260px;
      max-width: 90vw;
    }
    #question { font-size: 1.17rem; margin-bottom: 18px; font-weight: 600; text-align: center; min-height: 38px; letter-spacing: .01em;}
    #choices { display: flex; gap: 10px; justify-content: center; margin-bottom: 2px; opacity: 1; transition: opacity .3s;}
    .btn { padding: 8px 23px; font-size: 1rem; border: none; border-radius: 7px; cursor: pointer; font-weight: 600; transition: transform 0.08s; box-shadow: 0 2px 10px #0002;}
    .btn:active { transform: scale(0.97);}
    .red    { background: #d32f2f; color: #fff; }
    .yellow { background: #ffc107; color: #222; }
    .green  { background: #388e3c; color: #fff; }
    .table-wrap {
      position: relative;
      margin-bottom: 13px;
      border-radius: 13px;
      background: #1a2324;
      box-shadow: 0 2px 18px #0004;
      min-width: 220px;
      min-height: 100px;
      max-width: 96vw;
      max-height: 72vh;
      overflow: hidden;
      display: inline-block;
      width: 700px;
      height: 350px;
      transition: box-shadow .23s;
    }
    /* Ресайзеры: прямоугольные */
    .resize-rect {
      position: absolute;
      background: #ffe57f66;
      opacity: 0.28;
      z-index: 5;
      transition: opacity .13s, background .13s;
      border-radius: 5px;
    }
    .resize-rect:hover, .resize-rect.active {
      background: #ffe57fbb;
      opacity: 0.75;
    }
    .resize-rect.r { width: 10px; height: 48%; right: 1px; top: 24%; cursor: ew-resize;}
    .resize-rect.b { height: 10px; width: 48%; left: 24%; bottom: 1px; cursor: ns-resize;}
    .resize-rect.br { width: 18px; height: 18px; right: 1px; bottom: 1px; cursor: nwse-resize;}
    .table-controls {
      position: absolute;
      top: 8px; left: 12px; z-index: 10;
      display: flex; gap: 6px;
    }
    .mini-btn {
      width: 25px; height: 23px;
      background: #31484d;
      color: #ffe57f;
      border-radius: 5px;
      border: 2px solid #295757;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.09em;
      cursor: pointer;
      box-shadow: 0 1px 2px #0002;
      user-select: none;
      transition: background .14s, color .14s, border .13s;
      margin-right: 2px;
    }
    .mini-btn:active {
      background: #ffe57f;
      color: #1a2727;
      border-color: #ffe57f;
      transform: scale(0.95);
    }
    .scalable-table {
      width: 100%; height: 100%;
      overflow: auto !important;
      transition: font-size .20s, padding .20s;
      min-width: 180px; min-height: 60px;
      background: inherit;
      box-sizing: border-box;
    }
    table { border-collapse: collapse; background: #223233; color: #eee; min-width: 340px; font-size: 1em; position: relative; }
    th, td {
      border: 1px solid #455; padding: 6px 7px;
      text-align: center; min-width: 90px; white-space: nowrap;
      background: inherit; transition: background .21s, opacity .24s;
      position: relative; opacity: 1;
    }
    th, td { transition: opacity .24s; }
    th.new-cell, td.new-cell { opacity: 0; animation: fadeInCell .55s forwards; }
    @keyframes fadeInCell { from { opacity: 0; } to { opacity: 1; } }
    th { background: #295757; color: #ffe57f; font-size: 1em; transition: font-size .2s; }
    .row-num { background: #31484d; color: #ffe57f; font-weight: bold; min-width: 36px; width: 36px; font-size: 0.96em; border-left: 2px solid #295757; border-top: 2px solid #295757;}
    .dark-cell { background: #2a2f32 !important; color: #555 !important; font-size: 1.1em; font-weight: 600; opacity: 0.6;}
    .sum-col, .color-sect { font-weight: 700; font-size: 0.97em; border-left: 2px solid #295757;}
    .sum-col { background: #324d40; color: #fff;}
    .color-sect { padding: 0; background: #223233;}
    .color-sect > div { padding: 4px 0; border-radius: 10px 10px 0 0; margin: 0; font-size: 1.01em; font-weight: 700; letter-spacing: .3px;}
    .color-orange { background: #FF9800; color: #fff;}
    .color-yellow { background: #FFD600; color: #222;}
    .color-green  { background: #00C853; color: #fff;}
    .sum-row td { background: #182728; font-weight: bold; color: #fff; font-size: 1.01em;}
    .sum-final { border-radius: 0 0 10px 10px; font-size: 1.11em;}
    .sum-final.color-orange { background: #FF9800; color: #fff;}
    .sum-final.color-yellow { background: #FFD600; color: #222;}
    .sum-final.color-green  { background: #00C853; color: #fff;}
    .sum-final.empty { background: #263330; color: #888;}
    .sum-live { font-size: 1.1em; font-weight: bold; color: #66eea6; letter-spacing: .01em; background: #294840; border-radius: 0 0 10px 10px; border-top: 3px solid #fff780; min-width: 56px; transition: background .2s, color .2s; animation: pop .25s;}
    @keyframes pop { 0% {transform: scale(1.11);} 100% {transform: scale(1);}
    }
    .counter-box { margin: 10px auto 34px auto; padding: 9px 18px; background: #36fa99; color: #062c17; border-radius: 16px; display: inline-block; font-weight: 700; font-size: 1.09em; box-shadow: 0 2px 10px #0001; letter-spacing: .03em; transition: background .18s; border: 2.5px solid #77ffc3; text-shadow: 0 1px 0 #fff, 0 2px 3px #69fcaf66;}
    @media (max-width: 650px) {
      .table-wrap { min-width: 100vw; max-width: 100vw; }
      .scalable-table { min-width: 140px; }
      table { min-width: 140px;}
      th, td { min-width: 35px;}
    }
  </style>
</head>
<body>
  <div id="main">
    <div class="quiz-box" id="quiz-area">
      <div id="question"></div>
      <div id="choices"></div>
    </div>
    <div class="table-wrap" id="tableWrap">
      <!-- Ресайзеры-прямоугольники -->
      <div class="resize-rect r" id="resizeR"></div>
      <div class="resize-rect b" id="resizeB"></div>
      <div class="resize-rect br" id="resizeBR"></div>
      <!-- Кнопки + и - -->
      <div class="table-controls">
        <div class="mini-btn" onclick="resizeTable(-1)" title="Уменьшить контент">−</div>
        <div class="mini-btn" onclick="resizeTable(1)"  title="Увеличить контент">+</div>
      </div>
      <div id="excel-table"></div>
    </div>
    <div id="three-counter"></div>
  </div>
  <script>
    const questions = [
      "Почему важно сортировать мусор?",
      "Зачем экономить воду дома?",
      "Что такое повторное использование вещей?",
      "Как уменьшить загрязнение воздуха?",
      "Почему нужно сажать деревья?",
      "В чем польза общественного транспорта для экологии?",
      "Почему важно экономить электричество?",
      "Как пластиковые отходы вредят природе?",
      "Что такое органические продукты?",
      "Как уменьшить свой углеродный след?",
      "Что значит устойчивое потребление?",
      "Почему важно поддерживать биоразнообразие?",
      "Как можно сократить потребление пластика?",
      "Зачем использовать многоразовые сумки?",
      "Что такое компостирование?",
      "Как защищать редкие виды животных?",
      "Почему важно сохранять леса?",
      "Что такое возобновляемая энергия?",
      "Как влияет выброс CO2 на климат?",
      "Зачем участвовать в экологических акциях?"
    ];
    const numRows = questions.length;
    let answers = Array(numRows).fill(null);
    let currentQuestion = 0;
    let tableScale = 1;
    const minScale = 0.1, maxScale = 1.5;
    let lastN = 1;

    function typeWriter(text, el, delay = 12, cb) {
      el.innerHTML = '';
      let i = 0;
      el.classList.add('typewriter');
      function typing() {
        if (i < text.length) {
          el.innerHTML += text[i] === '\n' ? '<br>' : text[i];
          i++;
          setTimeout(typing, delay);
        } else {
          el.classList.remove('typewriter');
          if (cb) cb();
        }
      }
      typing();
    }

    function showQuestion() {
      if (currentQuestion < questions.length) {
        document.getElementById('question').innerText = `Вопрос ${currentQuestion+1} из 20: ${questions[currentQuestion]}`;
        document.getElementById('choices').style.opacity = 1;
        document.getElementById('choices').innerHTML = `
          <button class="btn red"    onclick="submitAnswer(0)">0</button>
          <button class="btn yellow" onclick="submitAnswer(1)">1</button>
          <button class="btn green"  onclick="submitAnswer(3)">3</button>
        `;
      } else {
        document.getElementById('quiz-area').style.display = 'none';
      }
      updateTable(true);
    }

    function submitAnswer(val) {
      document.getElementById('choices').style.opacity = 0;
      answers[currentQuestion] = val;
      setTimeout(() => {
        currentQuestion++;
        showQuestion();
        updateCounter();
      }, 180);
    }

    function getSum() {
      return answers.reduce((a, b) => a + (b !== null ? b : 0), 0);
    }
    function getSumColor(sum) {
      if (sum >= 17 && sum < 18) return 'color-orange';
      if (sum >= 18 && sum < 25) return 'color-yellow';
      if (sum >= 25 && sum <= 30) return 'color-green';
      return 'empty';
    }
    function getSumColumn(sum) {
      if (sum >= 17 && sum < 18) return 0; // Orange
      if (sum >= 18 && sum < 25) return 1; // Yellow
      if (sum >= 25 && sum <= 30) return 2; // Green
      return -1;
    }

    // ВАЖНО: отображаем все вопросы и все ответы, но fade-in для новых!
    function updateTable(withAnimation = false) {
      const N = Math.max(1, currentQuestion);
      let thFont = N > 9 ? "0.92em" : (N > 6 ? "0.99em" : "1.06em");
      let html = `<div class="scalable-table" id="scalableTable" style="font-size: ${tableScale}em;">`;
      html += `<table><tr><th class="row-num"></th>`;
      for (let q = 0; q < N; q++) {
        let anim = (withAnimation && N > lastN && q === N-1) ? "new-cell" : "";
        html += `<th class="${anim}" style="font-size:${thFont}"><span id="header-q-${q}"></span></th>`;
      }
      html += `<th class="sum-col">Сумма</th>`;
      html += `<th class="color-sect"><div class="color-orange">17–18</div></th>`;
      html += `<th class="color-sect"><div class="color-yellow">18–25</div></th>`;
      html += `<th class="color-sect"><div class="color-green">25–30</div></th>`;
      html += '</tr>';
      // Сумма (всегда сверху)
      let sum = getSum();
      let colorClass = getSumColor(sum);
      let sumCol = getSumColumn(sum);
      html += '<tr class="sum-row">';
      html += '<td></td>';
      for (let c = 0; c < N; c++) html += '<td></td>';
      html += `<td class="sum-live">${sum}</td>`;
      for (let i = 0; i < 3; i++) {
        html += (i === sumCol && currentQuestion >= numRows)
          ? `<td class="sum-final ${colorClass}">${sum}</td>`
          : `<td class="sum-final empty"></td>`;
      }
      html += '</tr>';
      // Строки-ответы: каждая строка только для уже отвеченных вопросов!
      for (let r = 0; r < N; r++) {
        let rowAnim = (withAnimation && N > lastN && r === N-1) ? "new-cell" : "";
        html += `<tr><td class="row-num ${rowAnim}">${r+1}</td>`;
        for (let c = 0; c < N; c++) {
          let anim = (withAnimation && N > lastN && (c === N-1 || r === N-1)) ? "new-cell" : "";
          if (r === c) {
            html += (answers[r] === null)
              ? `<td class="dark-cell ${anim}"></td>`
              : `<td class="${anim}">${answers[r]}</td>`;
          } else {
            html += `<td class="dark-cell ${anim}"></td>`;
          }
        }
        html += `<td class="sum-col"></td><td></td><td></td><td></td></tr>`;
      }
      html += '</table></div>';
      document.getElementById('excel-table').innerHTML = html;
      if (withAnimation && N > lastN) {
        setTimeout(() => {
          let cell = document.getElementById(`header-q-${N-1}`);
          if (cell && cell.innerHTML.trim() === '') {
            typeWriter(questions[N-1], cell, 12);
          }
        }, 90);
      } else {
        for (let i = 0; i < N; i++) {
          let cell = document.getElementById(`header-q-${i}`);
          if (cell) cell.innerHTML = questions[i];
        }
      }
      lastN = N;
    }

    function updateCounter() {
      let count3 = answers.filter(x => x === 3).length;
      document.getElementById('three-counter').innerHTML =
        `<div class="counter-box">Всего “3” выбрано: ${count3}</div>`;
    }

    // Кнопки +/−: меняют масштаб контента (шрифт/отступы)
    function resizeTable(delta) {
      tableScale += delta * 0.09;
      if (tableScale < minScale) tableScale = minScale;
      if (tableScale > maxScale) tableScale = maxScale;
      updateTable(false);
    }

    // Ресайзеры области
    const tableWrap = document.getElementById('tableWrap');
    let isResizing = false, resizeDir = "", startX = 0, startY = 0, startW = 0, startH = 0;

    function startResize(e, dir) {
      isResizing = true;
      resizeDir = dir;
      startX = e.clientX; startY = e.clientY;
      startW = tableWrap.offsetWidth;
      startH = tableWrap.offsetHeight;
      document.body.style.userSelect = "none";
      e.target.classList.add('active');
    }
    function doResize(e) {
      if (!isResizing) return;
      let dx = e.clientX - startX;
      let dy = e.clientY - startY;
      if (resizeDir === "both") {
        tableWrap.style.width = Math.max(140, startW + dx) + "px";
        tableWrap.style.height = Math.max(60, startH + dy) + "px";
      }
      if (resizeDir === "horiz") {
        tableWrap.style.width = Math.max(140, startW + dx) + "px";
      }
      if (resizeDir === "vert") {
        tableWrap.style.height = Math.max(60, startH + dy) + "px";
      }
    }
    function stopResize(e) {
      isResizing = false;
      document.body.style.userSelect = "";
      document.querySelectorAll('.resize-rect').forEach(el=>el.classList.remove('active'));
    }
    document.getElementById('resizeBR').addEventListener("mousedown", e => startResize(e, "both"));
    document.getElementById('resizeR').addEventListener("mousedown", e => startResize(e, "horiz"));
    document.getElementById('resizeB').addEventListener("mousedown", e => startResize(e, "vert"));
    window.addEventListener("mousemove", doResize);
    window.addEventListener("mouseup", stopResize);

    // Показываем первый вопрос
    showQuestion();
    updateCounter();
  </script>
</body>
</html>